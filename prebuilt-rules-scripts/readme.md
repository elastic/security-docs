# Create prebuilt rule documentation

Scripts are use to create the prebuilt rules documentation. Currently, four
scrips are used and they must be run in this order:

1. [`create-json-from-docs.py`](#create-json-from-docspy)
2. [`update_current_text.py`](#update_current_textpy)
3. [`get-rule-diff.py`](#get-rule-diffpy)
4. [`create_documentation.py`](#create_documentationpy)

Before running the scripts, you must download the JSON file containing all
prebuilt rules for the new release. For each release, these JSON files are saved
in the `orig-rules-json-files` folder.

After creating the documentation, you need to copy and paste the files in the
`generated-ascii-files` folder to their relevant location in the `docs` folder,
and then manually edit the text of new rules added for the latest release. This
includes converting Markdown to AsciiDoc and editing the English.

### `create-json-from-docs.py`

This script creates a JSON file containing the current prebuilt rules
documentation. The is done to avoid updating the formatting or text of rules
that have already been documented in previous releases.

Before running the script, you need to update the path name of the generated
JSON file (on line 95 in the script). Generally, you only need to change the
version number in the file name. So, if you are generating a JSON file for the
7.10 documentation, the path name of the generated JSON file should be:

`diff-files/gen-files/json-from-docs-7.10.0.json`

### `update_current_text.py`

This script creates a JSON file using the text from previously documented rules
(created with the `create-json-from-docs.py` script) and the (unedited) text for
the new rules added for the coming release. The generated file has an entry for
every prebuilt rule (preexisting and new ones).

Before running the script, these path names must be updated:

* `orig-rules-json-files/<version>-prebuilt-rule-new.json` (line 16): path
  of the downloaded JSON file with the new rules for coming release
* `diff-files/gen-files/json-from-docs-<version>.json` (line 21): path
  of the file generated by the `create-json-from-docs.py` script
* `diff-files/gen-files/updated-text-json-file-<version>.json` (line 37): path name
  of the file this script generates


### `get-rule-diff.py`

This script (finally) creates the JSON file that is actually used to generate the
documentation. It uses two previously created JSON files to do this: the file
created by the `update_current_text.py` script and the _final_ file created from
the previous time the prebuilt rule documentation was generated.

**IMPORTANT**: The _final_ files reside in the `diff-files/final-files` folder.
These files are generated by this script. They must be kept to ensure the rules'
version histories (rule version numbers and query changes) are documented
accurately. 

Before running the script: 

* These path names must be updated:

  * `diff-files/gen-files/updated-text-json-file-<version>.json` (line 20):
  path of the file generated by the `update_current_text.py` script.
  * `diff-files/final-files/final-rule-file-<version>.json` (line 25): path
  to the file generated by the script for the **previous** release.
  * `diff-files/final-files/final-rule-file-<version>.json` (line 79): path name
    of the file this script generates. This is the file that must be saved and
    will be used when generating the documentation for the next release.
    
    For example, if you are running the script to generate 7.10.0 prebuilt rules
    documentation, the path names should be:

  * `diff-files/gen-files/updated-text-json-file-7.10.0.json` (line 20)
  * `diff-files/final-files/final-rule-file-7.9.0.json` (line 25)
  * `diff-files/final-files/final-rule-file-7.10.0.json` (line 79, generated by
  the script and required when creating documentation for the next release, such
  as 7.11.0)

* The version numbers used in the conditions that determine whether the rule
  existed or not:

  * `new_rule['last_update'] = "7.9.0"` (line 52): update to the latest release
    number.
  * `new_rule['last_update'] = "7.9.0"` (line 70): update to the latest release
    number.
  * `new_rule['added'] = "7.9.0"` (line 71): update to the latest release
    number.

    For example, if you are generating documentation for 7.10.0:

  * `new_rule['last_update'] = "7.10.0"` (line 52)
  * `new_rule['last_update'] = "7.10.0"` (line 70)
  * `new_rule['added'] = "7.10.0"` (line 71)

### `create_documentation.py`

This script creates the prebuilt rules documentation! It creates `asciidoc`
files for each rule, the ToC (index) file, the version history file, and the
overview (table) file. All files are saved in the `generated-ascii-files`
folder. Once the files are generated, you should be able to just copy and paste
them into the `detections/prebuilt-rules` documentation folder.

Before running the script, these must be updated:

* `diff-files/final-files/final-rule-file-<version>.json` (line 60): path
  name of the file generated by the `get-rule-diff.py` script.
* Call to the `addVersionUpdates` function (lines 269-273): add a call for the
  new release immediately above the existing ones. For example, if you are
  generating documentation for 7.10.0:

  ```
  addVersionUpdates("7.10.0")
  addVersionUpdates("7.9.0")
  addVersionUpdates("7.8.0")
  addVersionUpdates("7.7.0")
  addVersionUpdates("7.6.2")
  addVersionUpdates("7.6.1")
  ```
