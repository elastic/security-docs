# Create prebuilt rule documentation

Scripts are use to create the prebuilt rules documentation. Currently, four
scrips are used and they must be run in this order:

1. [`create-json-from-docs.py`](#create-json-from-docspy)
2. [`update_current_text.py`](#update_current_textpy)
3. [`get-rule-diff.py`](#get-rule-diffpy)
4. [`create_documentation.py`](#create_documentationpy)

Before running the scripts, you must download the JSON file containing all
prebuilt rules for the new release. For each release, these JSON files are saved
in the `orig-rules-json-files` folder.

After creating the documentation, you need to copy and paste the files in the
`generated-ascii-files` folder to their relevant location in the `docs` folder,
and then manually edit the text of new rules added for the latest release. This
includes converting Markdown to AsciiDoc and editing the English.

### `create-json-from-docs.py`

This script creates a JSON file containing the current prebuilt rules
documentation. The is done to avoid updating the formatting or text of rules
that have already been documented in previous releases.

Before running the script, you need to update the `releaseVersion` variable (on
line 12 in the script) to the release number for which you are generating
docs. If you are generating a JSON file for the 7.10 documentation, the
variable should be:

`releaseVersion = "7.10.0"`

### `update_current_text.py`

This script creates a JSON file using the text from previously documented rules
(created with the `create-json-from-docs.py` script) and the (unedited) text for
the new rules added for the coming release. The generated file has an entry for
every prebuilt rule (preexisting and new ones).

Before running the script, update the `releaseVersion` variable (line 9) to the
release number for which you are generating docs. If you are generating a JSON
file for the 7.10 documentation, the variable should be:

`releaseVersion = "7.10.0"`


### `get-rule-diff.py`

This script (finally) creates the JSON file that is actually used to generate the
documentation. It uses two previously created JSON files to do this: the file
created by the `update_current_text.py` script and the _final_ file created from
the previous time the prebuilt rule documentation was generated.

**IMPORTANT**: The _final_ files reside in the `diff-files/final-files` folder.
These files are generated by this script. They must be kept to ensure the rules'
version histories (rule version numbers and query changes) are documented
accurately. 

Before running the script, these variables must be updated: 

* `releaseVersion` (line 13): The version for which the docs are being generated.
* `previousReleaseVersion` (line 14): The previous version for which docs were
  generated.

For example, if you are generating documentation for 7.10.0:

* `releaseVersion = "7.10.0"` (line 13)
* `previousReleaseVersion = "7.9.0"` (line 14)

### `create_documentation.py`

This script creates the prebuilt rules documentation! It creates `asciidoc`
files for each rule, the ToC (index) file, the version history file, and the
overview (table) file. All files are saved in the `generated-ascii-files`
folder. Once the files are generated, you should be able to just copy and paste
them into the `detections/prebuilt-rules` documentation folder.

Before running the script, these must be updated:

* `releaseVersion` variable (line 13): The version for which the docs are being
  generated.
* Call to the `addVersionUpdates` function (lines 269-273): add a call for the
  new release immediately above the existing ones. For example, if you are
  generating documentation for 7.10.0:

  ```
  addVersionUpdates("7.10.0")
  addVersionUpdates("7.9.0")
  addVersionUpdates("7.8.0")
  addVersionUpdates("7.7.0")
  addVersionUpdates("7.6.2")
  addVersionUpdates("7.6.1")
  ```
