[[install-endpoint]]
[role="xpack"]
= Configure and install the Endpoint Security integration

Like other Elastic integrations, Endpoint Security can be integrated into the Elastic Agent through {fleet-guide}/fleet-overview.html[{fleet}]. Upon configuration, the integration allows the Elastic Agent to monitor for events on your host and send data to the {security-app}.

NOTE: To configure the Endpoint Security integration on the {agent}, you must have permission to use {fleet} in {kib}. You must also have admin permissions in {kib} to access the **Endpoints** page in the {security-app}.

[discrete]
[[security-before-you-begin]]
== Before you begin

If you're using macOS, some versions may require you to grant Full Disk Access to different kernels, system extensions, or files. Refer to <<deploy-elastic-endpoint, requirements for {elastic-endpoint}>> if you're installing the {elastic-endpoint} or <<endgame-sensor-full-disk-access, requirements for the Endgame sensor>> for more information.

[discrete]
[[add-security-integration]]
== Add the Endpoint Security integration

. In {kib}, select **Security** -> **Endpoints**. If this is not your first time using {es-sec}, select **Management** -> **Integrations**, then search for and select **Endpoint Security**.
+
[role="screenshot"]
image::images/install-endpoint/security-integration.png[Search result for "Endpoint Security" on the Integrations page.]
+
. Select **Add Endpoint Security** on either the Endpoints page of the {security-app} or the Endpoint Security integration page (*Management* -> *Integrations*). The integration configuration page appears.
+
[role="screenshot"]
image::images/install-endpoint/add-elastic-endpoint-security.png[Add Endpoint Security integration page.]
+
. Configure the Endpoint Security integration with a name and optional description.
. Select an agent policy for the {agent}. You can select the default policy, an existing custom policy, or select **Create agent policy** to create a new one. For more details on {agent} configuration settings, see {fleet-guide}/agent-policy.html[{agent} policies].
. When the configuration is complete, click **Save and continue**.
. To complete the integration, continue to the next section to install the {agent} on your hosts.

[discrete]
[[enroll-security-agent]]
== Configure and enroll the Elastic Agent

To configure the {agent}, Endpoint Security requires enrollment through Fleet to enable the integration.

IMPORTANT: Before you add an {agent}, a {fleet-server} must be running. See {fleet-guide}/add-a-fleet-server.html[Add a {fleet-server}].

[discrete]
[[fleet-server-upgrade]]
=== Important information about the new {fleet-server}

NOTE: If you are running an {stack} version earlier than 7.13.0, you can skip this section.

If you have upgraded to an {stack} version that includes the new {fleet-server} (>=7.13.0), you will need to redeploy your agents. Review the following scenarios to ensure you take the appropriate steps.

* If you redeploy the {agent} to the same machine through the {fleet} application after you upgrade, a new agent will appear.
* If you want to remove the {agent} entirely without transitioning to the {fleet-server}, then you will need to manually uninstall the agent on the machine. This will also uninstall the endpoint. See {fleet-guide}/uninstall-elastic-agent.html[Uninstall Elastic Agent].
* In the rare event that the {agent} fails to uninstall, you might need to manually uninstall the endpoint. See <<uninstall-endpoint, Uninstall an endpoint>> at the end of this topic.

NOTE: Endpoint Security cannot be integrated with an {agent} in Standalone mode.

. Go to *{fleet}* -> *Agents* -> **Add agent**.
+
[role="screenshot"]
image::images/install-endpoint/add-agent.png[Add agent flyout on the Fleet page.]
+
. In the Add agent pane, download the {agent} on your host's machine.
. After the download is complete, select the **Endpoint Security** integration.
+
[role="screenshot"]
image::images/install-endpoint/endpoint-configuration.png[Detail of Add agent flyout with Endpoint Security integration highlighted.]
+
. After the {agent} is installed on your host machine, open a command-line interface and navigate to the directory where the agent is located. Copy the commands from {fleet} for your OS to enroll and run the agent.
+
. After you have enrolled the {agent} on your host, select **Close**. The host now appears on the **Endpoints** page in the {security-app}.

For macOS, continue with <<deploy-elastic-endpoint, these instructions>> to grant {elastic-endpoint} the access it needs.
