[[install-endpoint]]
[role="xpack"]
= Configure and install Elastic Endpoint Integration (beta)

beta[]


Like other Elastic integrations, Endpoint Security can be integrated into the Elastic Agent through {fleet-guide}/fleet-overview.html[{fleet}]. Upon configuration, the integration allows the Elastic Agent to monitor for events on your host and send data to the Elastic Security app.

NOTE: Configuring the Endpoint Integration on the Elastic Agent requires that the user have permission to use {fleet} in Kibana.

[discrete]
[[security-before-you-begin]]
== Before you begin

Depending on the version of macOS you're using, macOS requires that you give full disk access to different kernels, system extensions, or files. Review <<sensor-full-disk-access>> for details.

[discrete]
[[add-security-integration]]
== Add Elastic Endpoint integration

1. In Kibana, select **Security** > **Administration**. If this is not your first time using Elastic Security, select **{fleet}** > **Integrations** and search for "Endpoint Security".
+
[role="screenshot"]
image::images/install-endpoint/security-integration.png[]
+
2. On the Administration page of the {security-app} or the Endpoint Security integration page in Fleet, select **Add Endpoint Security**. The integration configuration page appears.
3. Select a configuration for the Elastic Agent. You can use either the **Default config**, or add security integration to a custom or existing configuration. For more details on Elastic Agent configuration settings, see {fleet-guide}/elastic-agent-configuration.html[Configuration settings].
4. Configure the Endpoint Security integration with a name and optional description. When configuration is complete, select **Save integration**. Kibana redirects you back to the administration section of the {security-app}.
+
[role="screenshot"]
image::images/install-endpoint/add-elastic-endpoint-security.png[]
+
5. On the "Enable Endpoint Security" on your Agent's page, select the name of your new integration. To enroll your agents with Endpoint Security, select **Enroll Agent**.
6. Kibana redirects you back to Fleet to add the Elastic Agent to your host.

[discrete]
[[enroll-security-agent]]
== Configure and enroll Elastic Agent

When integrating with the Elastic Agent, Endpoint Security **requires** enrollment through Fleet to enable the integration.

IMPORTANT: Endpoint Security cannot be integrated with an Elastic Agent in Standalone mode.

1. Go to Fleet. Select **Overview** > **Add agent**.
+
[role="screenshot"]
image::images/install-endpoint/add-agent.png[]
+
2. In the Add agent pane of the Configurations section, download the Elastic Agent on your host's machine.
3. After the download is complete, select an agent configuration. The selected integrations should include **Endpoint Security**.
+
[role="screenshot"]
image::images/install-endpoint/endpoint-configuration.png[]
+
4. After the {agent} is installed on your host machine, open a command-line interface, and navigate to your Agent's directory. Copy the commands from Fleet for your OS to enroll and run the Agent.

After you have enrolled the {agent} on your host, select **Continue**. The host now appears in the Endpoints list, located on the Administration page in the {security-app}.

To unenroll an agent from your host, see {fleet-guide}/unenroll-elastic-agent.html[Unenroll Elastic Agent].

[discrete]
[[enable-kernel-extension]]
== Enable Elastic Endpoint kernel

When running the {agent} with endpoint integrated on macOS 10.13, 10.14 and 10.15, you will be prompted to approve a kernel extension from "Endgame, Inc". To approve the extension:

TIP: Endgame Sensor users can approve the kernel the same way for the **Elastic Endgame** app.

1. Select **Open Security Preferences**. The **Security and Privacy** window opens.
+
[role="screenshot"]
image::images/install-endpoint/system-extension.png[]
+
2. Select the **Lock** icon at the bottom left of the window to make changes to your security settings.
+
[role="screenshot"]
image::images/install-endpoint/unlock-security-panel.png[]
+
3. Allow "Endgame, Inc" by selecting the **Allow** button.
+
[role="screenshot"]
image::images/install-endpoint/allow-endgame.png[]


If the prompt does not appear because you're using a version before macOS Big Sur (11.0), enable the extension by:

1. Open a Terminal application.
2. Enter `kextload /Library/Extension/kendpoint.kext`. Prepend the command with `sudo` if necessary.
3. Confirm the kernel extension has loaded, enter `kextstat | grep co.elastic.kendpoint`.
4. You should receive and output similar to `149    0 0xffffff7f82e7b000 0x21000    0x21000    co.elastic.kendpoint (7.9.0) BD152A57-ABD3-370A-BBE8-D15A0FCBD19A <6 5 2 1>`.

[discrete]
[[configure-malware]]
== Configure malware protection settings

After installing the agent, malware prevention is automatically enabled on protected hosts, including all event types for Windows's macOS, and Linux. If needed, you can configure malware protection settings to meet your company's security needs.

1. In the security app, select the **Administration** tab to view the Endpoints list. Remember that you must have admin permissions in {kib} to access this page.
2. From the **Integration Policy** column, select the Policy you want to configure. The Integration Policy page appears.
3. By default, the **Malware Protections Enabled** toggle is on, with host notifications enabled or disabled based on the protection level. To disable malware protection, switch the toggle off. Malware protection levels are as follows:

* **Detect**: Detects malware on the host and generates an alert. The agent will **not** block malware. You must pay attention to and analyze any malware alerts that are generated. Notifications do not appear by default. Select the **Notify User** option to enable them.
* **Prevent** (Default): Detects malware on the host, blocks it from executing, and generates an alert. Notifications appear by default. Deselect the **Notify User** option to disable them.
+
TIP: Platinum and enterprise users can customize these notifications using the `Elastic Security {action} {filename}`syntax. 

4. In the **Settings** section, review the types of events you would like collected based on your host's needs. All event types are collected by default. To not include an event in your collection, deselect that event.
5. Click **Save** to save changes to the Policy.
6. On the dialog that appears, click **Save and Deploy changes**. If successful, a "Success" confirmation appears in the lower-right corner.

[role="screenshot"]
image::images/install-endpoint/malware-protection.png[]

## Register as antivirus (Windows Only)

If you download the Elastic Agent on Windows 10 or above, you can configure Elastic Security as your antivirus software by doing the following:

1. Go to **Fleet** > **Agents**. A list of hosts with the Elastic Agent appears. 
2. Select your desired host from the list.
3. From the host's page, find your named **Endpoint** integration and select it. 
4. On the Integration Edit page, look for the **Protections** section and find **Type: Register as antivirus**. Toggle this option to enable. 
+
[role="screenshot"]
image::images/register-as-antivirus.png[]
5. Click **Save Integration**. Confirm that you would like to update your Elastic Agent. Once updated, Windows Defender will be disabled on your local host in favor of Elastic Security.

[discrete]
[[verify-endpoint-enrollment]]
== Verify Endpoint Enrollment

After installing the {agent}, there's a lag time of several hours between when the Elastic Endpoint begins detecting and sending alerts to {Kibana}. To ensure that the installation of Elastic Endpoint on your host was successful,  go to **Administration > Endpoints**. A message appears that says, "Endpoints are enrolling. View agents to track progress".

[role="screenshot"]
image::images/install-endpoint/endpoints-enrolling.png[]
