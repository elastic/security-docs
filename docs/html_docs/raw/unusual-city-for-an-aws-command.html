<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Unusual City For an AWS Command | Elastic Security Solution | Elastic</title>
<link rel="home" href="index.html" title="Elastic Security Solution"/>
<link rel="up" href="prebuilt-rules.html" title="Prebuilt rule reference"/>
<link rel="prev" href="unusual-aws-command-for-a-user.html" title="Unusual AWS Command for a User"/>
<link rel="next" href="unusual-country-for-an-aws-command.html" title="Unusual Country For an AWS Command"/>
<meta name="DC.type" content="Learn/Docs/"/>
<meta name="DC.subject" content=""/>
<meta name="DC.identifier" content=""/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elastic Security Solution</a></span>
»
<span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and Alerts (beta)</a></span>
»
<span class="breadcrumb-link"><a href="prebuilt-rules.html">Prebuilt rule reference</a></span>
»
<span class="breadcrumb-node">Unusual City For an AWS Command</span>
</div>
<div class="navheader">
<span class="prev">
<a href="unusual-aws-command-for-a-user.html">« Unusual AWS Command for a User</a>
</span>
<span class="next">
<a href="unusual-country-for-an-aws-command.html">Unusual Country For an AWS Command »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="unusual-city-for-an-aws-command"></a>Unusual City For an AWS Command<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/7.9/docs/detections/prebuilt-rules/rule-details/unusual-city-for-an-aws-command.asciidoc">edit</a></h2>
</div></div></div>
<p>A machine learning job detected AWS command activity that, while not inherently
suspicious or abnormal, is sourcing from a geolocation (city) that is unusual
for the command. This can be the result of compromised credentials or keys
being used by a threat actor in a different location from the authorized users.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: machine_learning</p>
<p><span class="strong strong"><strong>Machine learning job</strong></span>: rare_method_for_a_city</p>
<p><span class="strong strong"><strong>Machine learning anomaly threshold</strong></span>: 50</p>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 15 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-60m (<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://www.elastic.co/guide/en/security/master/prebuilt-ml-jobs.html" class="ulink" target="_top">https://www.elastic.co/guide/en/security/master/prebuilt-ml-jobs.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
AWS
</li>
<li class="listitem">
Elastic
</li>
<li class="listitem">
ML
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.9.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_potential_false_positives_103"></a>Potential false positives<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/7.9/docs/detections/prebuilt-rules/rule-details/unusual-city-for-an-aws-command.asciidoc">edit</a></h3>
</div></div></div>
<p>New or unusual command and user geolocation activity can be due to manual
troubleshooting or reconfiguration, changes in cloud automation scripts or
workflows, adoption of new services, expansion into new regions, increased
adoption of work from home policies, or users who travel frequently.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_investigation_guide_6"></a>Investigation guide<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/7.9/docs/detections/prebuilt-rules/rule-details/unusual-city-for-an-aws-command.asciidoc">edit</a></h3>
</div></div></div>
<p>Alerts from this rule indicate an AWS API command or method call that is rare
and unusual for the geolocation of the source IP address. Here are some
possible avenues of investigation:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Consider the source IP address and geolocation for the calling user who
issued the command. Do they look normal for the calling user? If the source is
an EC2 IP address, is it associated with an EC2 instance in one of your
accounts or could it be sourcing from an EC2 instance not under your control?
If it is an authorized EC2 instance, is the activity associated with normal
behavior for the instance role or roles? Are there any other alerts or signs of
suspicious activity involving this instance?
</li>
<li class="listitem">
Consider the user as identified by the <code class="literal">user.name</code> field. Is this command
part of an expected workflow for the user context? Examine the user identity in
the <code class="literal">aws.cloudtrail.user_identity.arn</code> field and the access key id in the
<code class="literal">aws.cloudtrail.user_identity.access_key_id</code> field, which can help identify the
precise user context. The user agent details in the <code class="literal">user_agent.original</code> field
may also indicate what type of client made the request.
</li>
<li class="listitem">
Consider the time of day. If the user is a human, not a program or script,
did the activity take place during normal working hours?
</li>
<li class="listitem">
Examine the history of the command. If the command, which is visible in the
<code class="literal">event.action</code> field, manifested only very recently, it might be part of a new
automation module or script. If its usage rate is consistent - for example, if
it appears in small numbers on a weekly or monthly basis - it might be part of
a housekeeping or maintenance process.
</li>
<li class="listitem">
Examine the request parameters. These may provide indications as to the
source of the program or the nature of the tasks it is performing.
</li>
</ul>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="unusual-aws-command-for-a-user.html">« Unusual AWS Command for a User</a>
</span>
<span class="next">
<a href="unusual-country-for-an-aws-command.html">Unusual Country For an AWS Command »</a>
</span>
</div>
</div>
</body>
</html>
