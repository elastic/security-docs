[[detections-ui-exceptions]]
[role="xpack"]
== Detection rule exceptions and value lists

Exceptions are added to detection rules and used to prevent alerts being
generated even when a rule's other criteria are met. Exceptions provide a
convenient way of preventing trusted processes and network activity from
generating unnecessary alerts.

In addition to defining exception queries for source event values, Exceptions
can be used with value lists. Value lists are lists of items with the same {es}
{ref}/mapping-types.html[data type]. You can create value lists with these
types:

* `keyword` (many {ecs-ref}/ecs-field-reference.html[ECS fields] are keywords)
* `ip`
* `ip_range`
* `text`

After value lists have been created, you can use `is in list` and
`is not in list` operators to define exceptions.

[float]
=== Create a value list

To create a value list for use with exceptions:

. Prepare a `txt` or `csv` file with all the values you want to use for
determining exceptions from a single list. If you use a `txt` file, new lines
act as value delimiters.
+
NOTE: All values in the file must be of the same {es} type.

. Go to *Security* -> *Detections* -> *Manage detection rules*.
. Click *Upload value lists*.
+
The *Upload value lists* window opens.

[role="screenshot"]
image::images/upload-lists-ui.png[]

. Select the list type (`Keywords`, `IP addresses`, `IP ranges`, or
`Text`)
. Drag or select the `csv` or `txt` file that contains the values.
. Click *Upload list*.

[float]
=== Add exceptions to a rule

You can add exceptions to a rule via the Rule details page or the Alerts table.
When you add an exception via the Alerts table, you can close either the alert
via which you are adding the exception or all alerts that meet the exception's
criteria. When you add an exception via the Rule details page, you can close
all alerts that meet the exception's criteria.

IMPORTANT: When you select to close all alerts that meet the exception's
criteria, all alerts matching the criteria closed *including* alerts generated
by other rules.

. To add an exception via the Rule details page:
.. Go to the Rule details page of the rule to which you want to add the
exception (*Security* -> *Detections* -> *Manage detection rules* ->
<rule name>).
.. Scroll down to the *Trend* histogram and select the *Exceptions* tab.
.. Click *Add new exception*.
. To add an exception via the Alerts table:
.. Go to Detections (*Security* -> *Detections*).
.. Scroll down to the Alerts table and click the more actions icon, and then
select *Add exception*.
+
The *Add Exception* window opens (via Alerts table).
+
[role="screenshot"]
image::images/add-exception-ui.png[]

. Add the conditions that define when the exception prevents the rule from
generating alerts. You can define multiple conditions and use `OR` and `AND`
logic to connect them. For example, the following conditions prevent a rule
from generating alerts when the `maintenance.exe` process runs on
`win-server-1`, `win-server-2`, or `win-server-3`:
+
[role="screenshot"]
image::images/exception-ui-query.png[]
+
If you have created value lists, you can use them to exclude or include all
values in a list with the `is in list` and `is not in list` operators:
+
[role="screenshot"]
image::images/exceptions-ui-list.png[]

. If required, select any of the following:

* _Close this alert_: Closes the alert when the exception is added.
* _Close all alerts that match attributes in this exception_: Closes all alerts
that match the exception's conditions. This option is only available when
adding exceptions via the Alerts table.

. Click *Add Exception*.
