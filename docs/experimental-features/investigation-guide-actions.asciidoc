[[interactive-investigation-guides]]
== Interactive investigation guides

NOTE: This feature is available for {stack} versions 8.6.0 and newer.

Detection rule investigation guides suggest steps for triaging, analyzing, and responding to potential security issues. When you create a custom rule, you can set up an interactive investigation guide that includes runtime query actions built from alert data or hard-coded literal values. 

[role="screenshot"]
image::images/ig-alert-flyout.png[Alert details flyout with interactive investigation guide,500]

This allows you to launch detailed Timeline investigations directly from alerts generated by the rule. The Timeline query is pre-loaded using the parameters configured in the investigation guide.

[role="screenshot"]
image::images/ig-timeline.png[Timeline with query pre-loaded from investigation guide action]

[discrete]
[[add-ig-actions-rule]]
=== Add investigation guide actions to a rule

NOTE: You can only add investigation guide actions to custom rules, because Elastic prebuilt rules can't be edited. However, if you want an interactive investigation guide on a prebuilt rule, you can duplicate the rule, then configure the investigation guide on the duplicated rule.

You can configure investigation guide actions when you create a new rule or edit an existing rule. When configuring the rule's settings (the *About rule* step for a new rule, the *About* tab for an existing rule), expand the *Advanced settings*, then scroll down to the *Investigation guide* field.

[role="screenshot"]
image::images/ig-investigation-guide-editor.png[Investigation guide editor field]

Add the following syntax to the Investigation guide field to create a query action. The syntax will be rendered as an action button in the alert.

[width="100%",options="header"]
|===
|Field |Description

|`label` |Label text on the action button.
|`description` |Description text on the action button.
|`providers` a|A two-level nested array that defines the query you want to run in Timeline. Similar to the structure of queries in Timeline, items in the outer level are joined by an OR relationship, and items in the inner level are joined by an AND relationship.

Each item in the `providers` array is defined by these key-value pairs:

* `field`: The name of a field to query.
* `value` The value to query for, either a hard-coded literal value or the name of the alert field whose value you want to use as a query parameter.
* `type`: Either `literal` or `parameter`.
|===

[discrete]
==== Example syntax

[source,json]
----
!{insight{
    "label": "Test action",
    "description": "Click to investigate",
    "providers": [
      [     
        {"field": "event.id", "value": "kibana.alert.original_event.id", "type": "parameter"}
      ],
      [  
        {"field": "event.action", "value": "rename", "type": "literal"},
        {"field": "process.pid", "value": "process.pid", "type": "parameter"}
      ]
    ]
}}
----

This example creates the following Timeline query, as illustrated below:

`(event.id : <alert value>)` +
`OR (event.action : "rename" AND process.pid : <alert value>)`

[role="screenshot"]
image::images/ig-timeline-query.png[Investigation guide editor field,500]
