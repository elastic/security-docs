[[interactive-investigation-guides]]
== Interactive investigation guides

NOTE: This feature is available for {stack} versions 8.6.0 and newer.

Detection rule investigation guides suggest steps for triaging, analyzing, and responding to potential security issues. When you create a custom rule, you can set up an interactive investigation guide that includes buttons for launching runtime queries in <<timelines-ui,Timeline>>, using both alert data and hard-coded literal values. Each query button displays the number of documents found.

[role="screenshot"]
image::images/ig-alert-flyout.png[Alert details flyout with interactive investigation guide,550]

This allows you to launch detailed Timeline investigations directly from an alert, using relevant alert data. The Timeline query is automatically created based on configuration in the investigation guide.

[role="screenshot"]
image::images/ig-timeline.png[Timeline with query pre-loaded from investigation guide action]

[discrete]
[[add-ig-actions-rule]]
=== Add investigation guide actions to a rule

NOTE: You can only create interactive investigation guides with custom rules, because Elastic prebuilt rules can't be edited. However, you can duplicate a prebuilt rule, then configure the investigation guide on the duplicated rule.

You can configure an interactive investigation guide when you <<rules-ui-create,create a new rule>> or <<edit-rules-settings,edit an existing rule>>. When configuring the rule's settings (the *About rule* step for a new rule, the *About* tab for an existing rule), expand the *Advanced settings*, then scroll down to the *Investigation guide* field.

[role="screenshot"]
image::images/ig-investigation-guide-editor.png[Investigation guide editor field]

Add the following syntax to the *Investigation guide* field to configure a query. The syntax will be rendered as an action button in the investigation guide.

[width="100%",options="header"]
|===
|Field |Description

|`!{insight{ }}` |The container object holding all the configuration attributes for the button and the query.
|`label` |Label text on the button.
|`description` |Description text on the button.
|`providers` a|A two-level nested array that defines the query you want to run in Timeline. Similar to the structure of queries in Timeline, items in the outer level are joined by an OR relationship, and items in the inner level are joined by an AND relationship.

Each item in `providers` is defined by these attributes:

* `field`: The name of a field to query.
* `value`: The value to search for. Either a hard-coded literal value, or the name of the field on the alert whose value you want to use as a query parameter.
* `type`: Either `literal` or `parameter`.
|===

[discrete]
==== Example syntax

[source,json]
----
!{insight{
    "label": "Test action",
    "description": "Click to investigate",
    "providers": [
      [     
        {"field": "event.id", "value": "kibana.alert.original_event.id", "type": "parameter"}
      ],
      [  
        {"field": "event.action", "value": "rename", "type": "literal"},
        {"field": "process.pid", "value": "process.pid", "type": "parameter"}
      ]
    ]
}}
----

This example creates the following Timeline query, as illustrated below:

`(event.id : <alert value>)` +
`OR (event.action : "rename" AND process.pid : <alert value>)`

[role="screenshot"]
image::images/ig-timeline-query.png[Timeline query,500]

[discrete]
==== Timeline template fields

When viewing an interactive investigation guide in contexts unconnected to a specific alert (such a rule's details page), queries open as <<timeline-templates-ui,Timeline templates>>, and `parameter` fields are treated as Timeline template fields.

[role="screenshot"]
image::images/ig-timeline-template-fields.png[Timeline template,500]

