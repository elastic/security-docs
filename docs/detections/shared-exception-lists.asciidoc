[[shared-exception-lists]]
== Create and manage shared exception lists
Shared exception lists allow rules to use the same exceptions. You can create a shared exception list to group a set of exception items together and then associate the list to multiple detection rules. 

[float]
[[create-shared-exception-list]]
=== Create shared exception lists

. Go to *Manage* -> *Rule Exceptions*.
. Click *Create shared exception list* -> *Create shared list*. 
. Give the shared exception list a name. 
. (Optional) Provide a description. 
. Click *Create shared exception list*.

[float]
[[add-exception-items]]
=== Add exception items to shared exception lists

. Go to *Manage* -> *Rule Exceptions*.
. Click *Create shared exception list* -> *Create exception item*. 
+
TIP: You can add exceptions to an empty shared exception list by expanding the list or viewing the lists details page and clicking *Create rule exception*. After creating an exception, you can associate the shared exception list with rules. Refer to <<link-shared-exception-lists>> to learn more.

. In the *Add rule exception* flyout, name the exception item and add conditions that define when the exception prevents alerts. When exception's query conditions are met (the query evaluates to `true`), rules do not generate alerts even when other rule criteria is met.
  .. *Field*: Select a field to identify the event being filtered.

  .. *Operator*: Select an operator to define the condition:
    * `is` | `is not` — Must be an exact match of the defined value.
    * `is one of` | `is not one of` — Matches any of the defined values.
    * `exists` | `does not exist` — The field exists.
    * `is in list` | `is not in list` — Matches values in a value list.
+
[NOTE]
=======
* An exception defined by a value list must use `is in list` or `is not in list` in all conditions.
* Wildcards are not supported in value lists.
* If a value list can't be used due to <<manage-value-lists,size or data type>>, it'll be unavailable in the *Value* menu.
=======
    * `matches` | `does not match` — Allows you to use wildcards in *Value*, such as `C:\path\*\app.exe`. Available wildcards are `?` (match one character) and `*` (match zero or more characters). The selected *Field* data type must be {ref}/keyword.html#keyword-field-type[keyword], {ref}/text.html#text-field-type[text], or {ref}/keyword.html#wildcard-field-type[wildcard].
+
IMPORTANT: Using wildcards can impact performance. To create a more efficient exception using wildcards, use multiple conditions and make them as specific as possible. For example, adding conditions using `process.name` or `file.name` can help limit the scope of wildcard matching.

  .. *Value*: Enter the value associated with the *Field*. To enter multiple values (when using `is one of` or `is not one of`), enter each value, then press **Return**.

. Click *AND* or *OR* to create multiple conditions and define their relationships.

. Click *Add nested condition* to create conditions using nested fields. This is only required for
<<nested-field-list, these nested fields>>. For all other fields, nested conditions should not be used.

. Choose to add the exception to shared exception lists. 
+ 
NOTE: This option will be unavailable to select if a shared exception list doesn't exist. In addition, you cannot add an endpoint exception item to the Endpoint Security Exception List. Refer to <<endpoint-rule-exceptions>> for instructions about creating endpoint exceptions. 

. (Optional) Enter a comment describing the exception.

* (Optional) *Close all alerts that match this exception and were generated by this rule*:
Closes all alerts that match the exception's conditions and were generated only by the current rule.
+
. Click *Add rule exception*.

[float]
[[link-shared-exception-lists]]
=== Associate shared exception lists with rules

. Go to *Manage* -> *Rule Exceptions*.
. Open the shared exception list details page by clicking on a shared exception list name. 
. Click *Manage rules*. 
. Choose rules to add the exception to. 
+
TIP: If you know a rule's name, you can enter it into the search bar.
. Click *Save*. 
. (Optional) Go to the details pages of the rules you added the exception to and click the *Rule exceptions* tab. Exceptions from a <<shared-exception-lists, shared exception list>> display the *Affects shared list* link. Click the link to view the associated shared exception lists. 
+
[role="screenshot"]
image::images/associated-shared-exception-list.png[]

[float]
[[view-shared-exception-lists]]
=== View shared exception lists 

The Rule Exceptions page displays exception items that were added to a shared exception list. The page displays each shared exception list on an individual row, with the most recently created list at the top. Each row contains the following information:

* The shared exception list name
* The date the list was created
* The username of the user who created the list
* The number of exception items in the shared exception list
* The number of rules the shared exception list affects
* Options to export or delete the shared exception list

[role="screenshot"]
image::images/exceptions-page.png[]

To view the details of an exception item that was added to a shared exception list, click the icon to expand the list. 

To filter exception lists by a specific value, enter a query in the https://elastic.github.io/eui/#/forms/search-bar[Search bar]. You can search the following attributes:

* `name`
* `list_id`
* `created_by`

If no attribute is selected, the app searches the list name by default.

[float]
[[manage-exception-lists]]
=== Manage shared exception lists

You can edit, export, import and delete shared exception lists from the Rule Exceptions page. 

NOTE: Exception lists that were created in 8.5 and earlier are imported as shared exception lists. 

To export or delete an exception list, select the required action button on the appropriate list. Note that:

* Exception lists are exported to `.ndjson` files.
* Exception lists are also exported as part of any exported detection rules configured with exceptions. Refer to <<import-export-rules-ui>>.
* If an exception list is linked to any rules, you'll get a warning asking you to confirm the deletion. If no rules are linked, the list is deleted without confirmation.

[role="screenshot"]
image::images/actions-exception-list.png[Detail of Exception lists table with export and delete buttons highlighted]
