[[shared-exception-lists]]
== Create and manage shared exception lists
Shared exception lists allow you to re-use exceptions across multiple rules and provide you with a central place for managing exception relationships. After creating a shared exception list, you can add exception items and associate the list with multiple rules. 

[float]
[[create-shared-exception-list]]
=== Create shared exception lists

. Go to *Manage* -> *Rule Exceptions*.
. Click *Create shared exception list* -> *Create shared list*. 
. Give the shared exception list a name. Providing a description is optional. 
. Click *Create shared exception list*.

[float]
[[add-exception-items]]
=== Add exception items to shared exception lists

. Go to *Manage* -> *Rule Exceptions*.
. Click *Create shared exception list* -> *Create exception item*. 
+
TIP: You can add exceptions to an empty shared exception list by expanding the list and clicking Create rule exception. After creating an exception, you can associate the shared exception list with rules. Refer to <<link-shared-exception-lists>> to learn more.

. In the *Add Rule Exception* flyout, name the exception item and add conditions that define when the exception prevents alerts. When exception's query conditions are met (the query evaluates to `true`), rules do not generate alerts even when other rule criteria is met.
  .. *Field*: Select a field to identify the event being filtered.

  .. *Operator*: Select an operator to define the condition:
    * `is` | `is not` — Must be an exact match of the defined value.
    * `is one of` | `is not one of` — Matches any of the defined values.
    * `exists` | `does not exist` — The field exists.
    * `is in list` | `is not in list` — Matches values in a value list.
+
[NOTE]
=======
* An exception defined by a value list must use `is in list` or `is not in list` in all conditions.
* Wildcards are not supported in value lists.
* If a value list can't be used due to <<manage-value-lists,size or data type>>, it'll be unavailable in the *Value* menu.
=======
    * `matches` | `does not match` — Allows you to use wildcards in *Value*, such as `C:\path\*\app.exe`. Available wildcards are `?` (match one character) and `*` (match zero or more characters). The selected *Field* data type must be {ref}/keyword.html#keyword-field-type[keyword], {ref}/text.html#text-field-type[text], or {ref}/keyword.html#wildcard-field-type[wildcard].
+
IMPORTANT: Using wildcards can impact performance. To create a more efficient exception using wildcards, use multiple conditions and make them as specific as possible. For example, adding conditions using `process.name` or `file.name` can help limit the scope of wildcard matching.

  .. *Value*: Enter the value associated with the *Field*. To enter multiple values (when using `is one of` or `is not one of`), enter each value, then press **Return**.

. Click *AND* or *OR* to create multiple conditions and define their relationships.

. Click *Add nested condition* to create conditions using nested fields. This is only required for
<<nested-field-list, these nested fields>>. For all other fields, nested conditions should not be used.

. Choose to add the exception to shared exception lists. 
+ 
NOTE: If a shared exception list doesn't exist, this option will not be available to select.

. (Optional) Enter a comment describing the exception.

. Select one of the following alert actions:

* *Close this alert*: Closes the alert when the exception is added. This option
is only available when adding exceptions from the Alerts table.
* *Close all alerts that match this exception and were generated by this rule*:
Closes all alerts that match the exception's conditions and were generated only by the current rule.
+
. Click *Add Rule Exception*.

[float]
[[link-shared-exception-lists]]
=== Associate shared exception lists with rules

. Go to *Manage* -> *Rule Exceptions*.
. Open the shared exception list details page by clicking on a shared exception list name. 
. Click *Manage rules*. 
. Select rules. You can add the exception to one or more rules. 
. Click *Save*. 

To verify that shared exception list was added to the rules you selected, open one of the rule's details page (*Manage* -> *Rules* -> *<Rule name>*), scroll down the page, and then select the *Rule exceptions* tab. Navigate to the exception items that are included in the shared exception list. The *Affects shared list* link displays in the exception details. Click the link to view the shared exception lists that the exception is a part of. 

[role="screenshot"]
image::images/associated-shared-exception-list.png[]

[float]
[[view-shared-exception-lists]]
=== View shared exception lists 

The Rule Exceptions page displays exception items that were added to a shared exception list. The page displays each shared exception list on an individual row, with the most recently created list at the top. Each row contains the following information:

* The shared exception list name
* The date the list was created
* The username of the user who created the list
* The number of exception items in the shared exception list
* The number of rules the shared exception list affects
* Options to export or delete the shared exception list

[role="screenshot"]
image::images/exceptions-page.png[]

To view the details of an exception item that was added to a shared exception list, click the icon to expand the list. 

To filter exception lists by a specific value, enter a query in the https://elastic.github.io/eui/#/forms/search-bar[Search bar]. You can search the following attributes:

* `name`
* `list_id`
* `created_by`

If no attribute is selected, the app searches the list name by default.

[float]
[[manage-exception-lists]]
=== Manage shared exception lists

You can edit, export, import and delete shared exception lists from the Rule Exceptions page. 

NOTE: Exception lists that were created in 8.5 and earlier are imported as shared exception lists. 

To export or delete an exception list, select the required action button on the appropriate list. Note that:

* Exception lists are exported to `.ndjson` files.
* Exception lists are also exported as part of any exported detection rules configured with exceptions. Refer to <<import-export-rules-ui>>.
* If an exception list is linked to any rules, you'll get a warning asking you to confirm the deletion. If no rules are linked, the list is deleted without confirmation.

[role="screenshot"]
image::images/actions-exception-list.png[Detail of Exception lists table with export and delete buttons highlighted]
