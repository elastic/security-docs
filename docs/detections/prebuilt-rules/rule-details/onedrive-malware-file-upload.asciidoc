[[onedrive-malware-file-upload]]
=== OneDrive Malware File Upload

Identifies the occurence of files uploaded to OneDrive being detected as Malware by the file scanning engine. Attackers can use File Sharing and Organization Repositories to spread laterally within the company and amplify their access. Users can inadvertently share these files without knowing their maliciousness, giving adversaries opportunity to gain initial access to other endpoints in the environment.

*Rule type*: query

*Rule indices*:

* filebeat-*
* logs-o365*

*Severity*: high

*Risk score*: 73

*Runs every*: 5 minutes

*Searches indices from*: now-30m ({ref}/common-options.html#date-math[Date Math format], see also <<rule-schedule, `Additional look-back time`>>)

*Maximum alerts per execution*: 100

*References*:

* https://docs.microsoft.com/en-us/microsoft-365/security/office-365-security/virus-detection-in-spo?view=o365-worldwide

*Tags*:

* Elastic
* Cloud
* Microsoft 365
* Continuous Monitoring
* SecOps
* Lateral Movement

*Version*: 101 (<<onedrive-malware-file-upload-history, version history>>)

*Added ({stack} release)*: 8.1.0

*Last modified ({stack} release)*: 8.6.0

*Rule authors*: Elastic

*Rule license*: Elastic License v2

==== Potential false positives

Benign files can trigger signatures in the built-in virus protection

==== Investigation guide


[source,markdown]
----------------------------------

----------------------------------


==== Rule query


[source,js]
----------------------------------
event.dataset:o365.audit and event.provider:OneDrive and
event.code:SharePointFileOperation and
event.action:FileMalwareDetected
----------------------------------

==== Threat mapping

*Framework*: MITRE ATT&CK^TM^

* Tactic:
** Name: Lateral Movement
** ID: TA0008
** Reference URL: https://attack.mitre.org/tactics/TA0008/
* Technique:
** Name: Taint Shared Content
** ID: T1080
** Reference URL: https://attack.mitre.org/techniques/T1080/

[[onedrive-malware-file-upload-history]]
==== Rule version history

Version 101 (8.6.0 release)::
* Formatting only

Version 100 (8.5.0 release)::
* Formatting only

Version 3 (8.4.0 release)::
* Formatting only

