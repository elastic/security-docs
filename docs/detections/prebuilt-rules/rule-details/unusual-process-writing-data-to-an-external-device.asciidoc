[[unusual-process-writing-data-to-an-external-device]]
=== Unusual Process Writing Data to an External Device

A machine learning job has detected a rare process writing data to an external device. Malicious actors often use benign-looking processes to mask their data exfiltration activities. The discovery of such a process that has no legitimate reason to write data to external devices can indicate exfiltration.

*Rule type*: machine_learning

*Rule indices*: None

*Severity*: low

*Risk score*: 21

*Runs every*: 15m

*Searches indices from*: now-2h ({ref}/common-options.html#date-math[Date Math format], see also <<rule-schedule, `Additional look-back time`>>)

*Maximum alerts per execution*: 100

*References*: 

* https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html
* https://docs.elastic.co/en/integrations/ded
* https://www.elastic.co/blog/detect-data-exfiltration-activity-with-kibanas-new-integration

*Tags*: 

* Use Case: Data Exfiltration Detection
* Rule Type: ML
* Rule Type: Machine Learning
* Tactic: Exfiltration

*Version*: 2

*Rule authors*: 

* Elastic

*Rule license*: Elastic License v2


==== Setup


The rule requires the Data Exfiltration Detection integration assets to be installed, as well as network and file events collected by integrations such as Elastic Defend and Network Packet Capture (for network events only).  


*Data Exfiltration Detection Setup*

The Data Exfiltration Detection integration detects data exfiltration activity by identifying abnormalities in network and file events. Anomalies are detected using Elastic's Anomaly Detection feature. 


*Prerequisite Requirements:*

- Fleet is required for Data Exfiltration Detection.
- To configure Fleet Server refer to the https://www.elastic.co/guide/en/fleet/current/fleet-server.html[documentation].
- File events collected by the Elastic Defend integration.
- To install Elastic Defend, refer to the https://www.elastic.co/guide/en/security/current/install-endpoint.html[documentation].


*The following steps should be executed to install assets associated with the Data Exfiltration Detection integration:*

- Go to the Kibana homepage. Under Management, click Integrations.
- In the query bar, search for Data Exfiltration Detection and select the integration to see more details about it.
- Under Settings, click Install Data Exfiltration Detection assets and follow the prompts to install the assets.


*Anomaly Detection Setup*

Before you can enable rules for Data Exfiltration Detection, you'll need to enable the corresponding Anomaly Detection jobs. 
- Go to the Kibana homepage. Under Analytics, click Machine Learning.
- Under Anomaly Detection, click Jobs, and then click "Create job". Select the Data View containing your file events. For example, this would be `logs-endpoint.events.*` if you used Elastic Defend to collect events.
- If the selected Data View contains events that match the query in https://github.com/elastic/integrations/blob/main/packages/ded/kibana/ml_module/ded-ml.json[this] configuration file, you will see a card for Data Exfiltration Detection under "Use preconfigured jobs".
- Keep the default settings and click "Create jobs" to start the anomaly detection jobs and datafeeds.


*Framework*: MITRE ATT&CK^TM^

* Tactic:
** Name: Exfiltration
** ID: TA0010
** Reference URL: https://attack.mitre.org/tactics/TA0010/
* Technique:
** Name: Exfiltration Over Physical Medium
** ID: T1052
** Reference URL: https://attack.mitre.org/techniques/T1052/
